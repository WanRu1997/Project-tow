<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="http://at.alicdn.com/t/font_726778_y7t4pdzlxca.css">
    <title>index</title>
</head>
<body class="iconfont">
    <header>
        <a class="login-icon" href="#"><b class="icon-denglu"></b></a>
    </header>    
    <main>
        <div class="flip-modal login">
            <div class="modal modal-login">
                <a href="#" class="close"><b class="icon-close"></b></a>
                <div class="title">
                    <a href="#" class="login">登陆</a>
                    <a href="#" class="register">注册</a>
                </div>
                <div class="content">
                    <div class="errormsg"></div>
                    <form action="#" method="POST">
                        <div class="input-field">
                            <b class="icon-username"></b>
                            <input type="text" name="username" placeholder="用户名">
                        </div>
                        <div class="input-field">
                            <b class="icon-password"></b>
                            <input type="password" name="password" placeholder="密码">
                        </div>
                        <div class="input-field"><input type="submit" name="login" value="登陆"></div>
                    </form>
                </div>
            </div>
            <div class="modal modal-register">
                <a href="#" class="close"><b class="icon-close"></b></a>
                <div class="title ">
                    <a href="#" class="login">登陆</a>
                    <a href="#" class="register">注册</a>
                </div>
                <div class="content">
                    <div class="errormsg"></div>
                    <form action="#" method="POST">
                        <div class="input-field">
                            <b class="icon-username"></b>
                            <input type="text" name="username" placeholder="用户名">
                        </div>
                        <div class="input-field">
                            <b class="icon-password"></b>
                            <input type="password" name="password" placeholder="密码">
                        </div>
                        <div class="input-field">
                            <b class="icon-password"></b>
                            <input type="password" name="password2" placeholder="密码">
                        </div>
                        <div class="input-field">
                            <input type="submit"  name="button" value="注册">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>
    <script>
    function $(select){
        return document.querySelector(select);
    }
    function $$(select){
        return document.querySelectorAll(select);
    }
    //下面是根据一个操作一个函数去写的
    /* $$('.modal .login').forEach(function(node){
        node.onclick = function(){
            $('.flip-modal').classList.add('login');
            $('.flip-modal').classList.remove('register');
        }
    });
    $$('.modal .register').forEach(function(node){
        node.onclick = function(){
        $('.flip-modal').classList.add('register');
        $('.flip-modal').classList.remove('login');
        }
    });*/
    $('header .login-icon').onclick = function(e){
        e.stopPropagation();
        $('.flip-modal').style.display = 'block';
    }  
   $$('.modal .close').forEach(function(node){
        node.onclick = function(){
            $('.flip-modal').style.display = 'none';
        }
    }) 
    //下面是将分步写的整理成一个事件监听
    $('.flip-modal').addEventListener('click',function(e){
        e.stopPropagation();
        if(e.target.classList.contains('login')){
            $('.flip-modal').classList.add('login');
            $('.flip-modal').classList.remove('register');
        }
        if(e.target.classList.contains('register')){
            $('.flip-modal').classList.add('register');
            $('.flip-modal').classList.remove('login');
        }
    })
    document.addEventListener('click',function(){
        $('.flip-modal').style.display = 'none';
    });
    //表单信息的验证
    $('.modal-login form').addEventListener('submit',function(e){
        e.preventDefault()
        if(!/^\w{3,8}$/.test($('.modal-login input[name=username]').value)
        ){
            $('.modal-login .errormsg').innerText = '用户名需输入3-8个字符，包括字母数字下划线';
            return false;
        }
        if(!/^\w{6,10}$/.test($('.modal-login input[name=password]').value)
        ){
            $('.modal-login .errormsg').innerText = '密码需输入6-10个字符，包括字母数字下划线';
            return false;
        }
        this.submit();
    });
    $('.modal-register form').addEventListener('submit',function(e){
        e.preventDefault();
        if(!/^\w{3,8}$/.test($('.modal-register input[name=username]').value)){
            $('.modal-register .errormsg').innerText = '用户名需输入3-8个字符，包括字母数字下划线';
            return false;
        }
        if(!/^\w{6,10}$/.test($('.modal-register input[name=password]').value)){
            $('.modal-register .errormsg').innerText = '密码需输入6-10个字符，包括字母数字下划线';
            return false;
        }
        if($('.modal-register input[name=password]').value!== $('.modal-register input[name=password2]').value){
            $('.modal-register .errormsg').innerText = '两次密码输入不一致';
            return false;
        }
        this.submit();
    })
    </script>
</body>
</html>